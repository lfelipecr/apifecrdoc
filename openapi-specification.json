{
  "openapi": "3.0.0",
  "info": {
    "title": "API CR Versión 4.4",
    "description": "Documentación completa de la API para interactuar con los servicios de facturación electrónica, basada en la colección de Postman.",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:8078",
      "description": "Servidor de desarrollo local"
    }
  ],
  "paths": {
    "/cr_api-staging/create_xml": {
      "post": {
        "tags": [
          "1. Crear XML"
        ],
        "summary": "Crear XML (FE, NC, ND, TE, REP, MR)",
        "description": "Crea cualquier tipo de documento electrónico (Factura, Nota de Crédito, etc.) basado en el `tipo_documento`.",
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "secret_key": { "type": "string", "description": "Llave secreta de autenticación." },
                  "tipo_documento": { "type": "string", "description": "Tipo de documento: FE, NC, ND, TE, REP, MR, FEC, FEE." },
                  "clave": { "type": "string" },
                  "consecutivo": { "type": "string" },
                  "proveedor_sistemas": { "type": "string" },
                  "fecha_emision": { "type": "string", "format": "date-time" },
                  "emisor_nombre": { "type": "string" },
                  "emisor_tipo_identificacion": { "type": "string" },
                  "emisor_numero_identififcacion": { "type": "string" },
                  "emisor_nombre_comercial": { "type": "string" },
                  "emisor_provincia": { "type": "string" },
                  "emisor_canton": { "type": "string" },
                  "emisor_distrito": { "type": "string" },
                  "emisor_barrio": { "type": "string" },
                  "emisor_otras_senas": { "type": "string" },
                  "emisor_codigo_pais_telefono": { "type": "string" },
                  "emisor_telefono": { "type": "string" },
                  "emisor_email": { "type": "string" },
                  "receptor_nombre": { "type": "string" },
                  "receptor_tipo_identificacion": { "type": "string" },
                  "receptor_numero_identificacion": { "type": "string" },
                  "receptor_provincia": { "type": "string" },
                  "receptor_canton": { "type": "string" },
                  "receptor_distrito": { "type": "string" },
                  "receptor_barrio": { "type": "string" },
                  "receptor_otras_senas": { "type": "string" },
                  "receptor_codigo_pais_telefono": { "type": "string" },
                  "receptor_telefono": { "type": "string" },
                  "receptor_email": { "type": "string" },
                  "receptor_nombre_comercial": { "type": "string" },
                  "codigo_actividad_emisor": { "type": "string" },
                  "condicion_venta": { "type": "string" },
                  "plazo_credito": { "type": "string" },
                  "detalle_servicio": { "type": "string", "description": "JSON string con el detalle de las líneas de la factura." },
                  "codigo_moneda": { "type": "string" },
                  "tipo_cambio": { "type": "string" },
                  "total_serv_gravados": { "type": "string" },
                  "total_serv_exentos": { "type": "string" },
                  "total_merc_gravadas": { "type": "string" },
                  "total_merc_exentas": { "type": "string" },
                  "total_gravado": { "type": "string" },
                  "total_exento": { "type": "string" },
                  "total_venta": { "type": "string" },
                  "total_descuentos": { "type": "string" },
                  "total_venta_neta": { "type": "string" },
                  "total_impuesto": { "type": "string" },
                  "total_comprobante": { "type": "string" },
                  "total_desglose_impuesto": { "type": "string", "description": "JSON string con el desglose de impuestos." },
                  "medios_pago": { "type": "string", "description": "JSON string con los medios de pago." },
                  "otros": { "type": "string", "description": "JSON string para campos adicionales." },
                  "informacion_referencia": { "type": "string", "description": "JSON string con la información de referencia para NC/ND." },
                  "numero_cedula_emisor": { "type": "string", "description": "Solo para MR." },
                  "fecha_emision_documento": { "type": "string", "description": "Solo para MR." },
                  "mensaje": { "type": "string", "description": "Solo para MR: 1 (aceptado), 2 (parcial), 3 (rechazado)." },
                  "detalle_mensaje": { "type": "string", "description": "Solo para MR." },
                  "monto_total_impuesto": { "type": "string", "description": "Solo para MR." },
                  "total_factura": { "type": "string", "description": "Solo para MR." },
                  "numero_cedula_receptor": { "type": "string", "description": "Solo para MR." },
                  "numero_consecutivo_receptor": { "type": "string", "description": "Solo para MR." }
                },
                "required": ["secret_key", "tipo_documento"]
              }
            }
          }
        },
        "responses": { "200": { "description": "Respuesta exitosa" } }
      }
    },
    "/cr_api-staging/certified_upload": {
      "post": {
        "tags": [
          "2. Certificado"
        ],
        "summary": "Subir certificado",
        "description": "Sube el certificado P12 para la firma de documentos.",
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "secret_key": { "type": "string" },
                  "archivo_p12": { "type": "string", "format": "binary", "description": "Archivo .p12 del certificado." },
                   "pin": { "type": "string", "description": "PIN del certificado (si no se envía aquí, se debe enviar al firmar)." }
                }, "required": ["secret_key", "archivo_p12"] } } } },
        "responses": { "200": { "description": "Respuesta exitosa" } }
      }
    },
    "/cr_api-staging/certified_get": {
      "get": {
        "tags": [
          "2. Certificado"
        ],
        "summary": "Obtener certificado",
        "description": "Obtiene información del certificado cargado.",
        "parameters": [
          { "name": "secret_key", "in": "query", "required": true, "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Respuesta exitosa" } }
      }
    },
    "/cr_api-staging/generate_key": {
      "post": {
        "tags": [
          "3. Clave y Firma"
        ],
        "summary": "Generar clave",
        "description": "Genera una clave numérica de 50 dígitos para un documento.",
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "secret_key": { "type": "string" },
                  "sucursal": { "type": "string" },
                  "terminal": { "type": "string" },
                  "secuencia": { "type": "string" },
                  "tipo_documento": { "type": "string" },
                  "numero_identificacion": { "type": "string" },
                  "situacion": { "type": "string" },
                  "codigo_pais": { "type": "string" }
                },
                "required": ["secret_key", "sucursal", "terminal", "secuencia", "tipo_documento", "numero_identificacion", "situacion", "codigo_pais"]
              }
            }
          }
        },
        "responses": { "200": { "description": "Respuesta exitosa" } }
      }
    },
    "/cr_api-staging/xml_sign": {
      "post": {
        "tags": [
          "3. Clave y Firma"
        ],
        "summary": "Firmar xml",
        "description": "Firma un documento XML utilizando el certificado cargado.",
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "secret_key": { "type": "string" },
                  "pin": { "type": "string", "description": "PIN del certificado." },
                  "codigo_certificado": { "type": "string", "description": "Código obtenido al subir el certificado." },
                  "comprobante_xml": { "type": "string", "description": "Contenido del XML sin firmar (en texto plano o Base64)." }
                },
                "required": ["secret_key", "pin", "codigo_certificado", "comprobante_xml"]
              }
            }
          }
        },
        "responses": { "200": { "description": "Respuesta exitosa" } }
      }
    },
    "/cr_api-staging/send_hacienda": {
      "post": {
        "tags": [
          "4. Hacienda"
        ],
        "summary": "Hacienda envío",
        "description": "Envía el documento XML firmado a Hacienda.",
        "requestBody": {
          "required": true,
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "secret_key": { "type": "string" },
                  "comprobante_xml_firmado": { "type": "string", "description": "Contenido del XML firmado en Base64." },
                  "usuario_hacienda": { "type": "string" },
                  "contrasena_hacienda": { "type": "string" },
                  "clave": { "type": "string" },
                  "fecha": { "type": "string", "format": "date-time" },
                  "emisor_tipo_identificacion": { "type": "string" },
                  "emisor_numero_identificacion": { "type": "string" },
                  "receptor_tipo_identificacion": { "type": "string" },
                  "receptor_numero_identificacion": { "type": "string" }
                },
                "required": ["secret_key", "comprobante_xml_firmado", "usuario_hacienda", "contrasena_hacienda", "clave"]
              }
            }
          }
        },
        "responses": { "200": { "description": "Respuesta exitosa" } }
      }
    },
    "/cr_api-staging/consult_hacienda": {
      "get": {
        "tags": [
          "4. Hacienda"
        ],
        "summary": "Hacienda consulta",
        "description": "Consulta el estado de un documento en Hacienda.",
        "parameters": [
          { "name": "secret_key", "in": "query", "required": true, "schema": { "type": "string" } },
          { "name": "usuario_hacienda", "in": "query", "required": true, "schema": { "type": "string" } },
          { "name": "contrasena_hacienda", "in": "query", "required": true, "schema": { "type": "string" } },
          { "name": "clave", "in": "query", "required": true, "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Respuesta exitosa" } }
      }
    }
  },
  "components": {
    "schemas": {},
    "securitySchemes": {}
  }
}